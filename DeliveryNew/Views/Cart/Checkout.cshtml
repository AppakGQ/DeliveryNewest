@model DeliveryNew.Models.Cart
@{
    ViewData["Title"] = "Оформление заказа";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <div class="glass-card p-4 text-white">
                <h2 class="mb-4">Подтверждение заказа</h2>
                <ul class="list-group list-group-flush mb-3">
                    @foreach(var item in Model.Items)
                    {
                        <li class="list-group-item bg-transparent text-white d-flex justify-content-between">
                            <span>@item.DeliveryItem.Name x @item.Quantity</span>
                            <span>@((item.Quantity * item.DeliveryItem.Price).ToString("c"))</span>
                        </li>
                    }
                     <li class="list-group-item bg-transparent text-white d-flex justify-content-between fw-bold fs-5">
                        <span>Итого:</span>
                        <span>@Model.TotalValue.ToString("c")</span>
                    </li>
                </ul>
                
                <form id="paymentForm">
                     <div class="mb-3">
                        <label class="form-label">Адрес доставки</label>
                        <input type="text" class="form-control glass-input" required placeholder="Введите ваш адрес" />
                    </div>
                     <div class="mb-3">
                        <label class="form-label">Номер карты</label>
                        <input type="text" class="form-control glass-input" required placeholder="0000 0000 0000 0000" />
                    </div>
                </form>

                <button type="button" class="btn btn-success btn-lg w-100 mt-3" data-bs-toggle="modal" data-bs-target="#paymentModal">
                    Оплатить @Model.TotalValue.ToString("c")
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card border-0">
      <div class="modal-body text-center text-white py-5">
        <div id="processing">
            <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;"></div>
            <h4>Обработка платежа...</h4>
            <p>Пожалуйста, подождите.</p>
        </div>
        <div id="success" style="display:none;">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
            <h3 class="mt-3">Оплата прошла успешно!</h3>
            <p>Ваш заказ принят в работу.</p>
            <form asp-action="ProcessPayment" method="post">
                 <button type="submit" class="btn btn-light mt-3">Завершить</button>
            </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    var myModalEl = document.getElementById('paymentModal')
    myModalEl.addEventListener('shown.bs.modal', function (event) {
        setTimeout(function() {
            document.getElementById('processing').style.display = 'none';
            document.getElementById('success').style.display = 'block';
        }, 2000);
    })
</script>
